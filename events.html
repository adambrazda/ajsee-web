<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title data-i18n-key="events-page-title">Události</title>

  <!-- Favicona: umlčí 404 v dev/prod i bez souborů -->
  <link rel="icon" href="data:,">

  <!-- Google tag (gtag.js) – jen na HTTPS / produkci -->
  <script>
    (function(){
      const isProdHttps = location.protocol === 'https:' && !/localhost|127\.0\.0\.1/i.test(location.hostname);
      if (!isProdHttps) {
        console.info('[GA] Skipping on non-HTTPS/dev.');
        return;
      }
      const s = document.createElement('script');
      s.async = true;
      s.src = 'https://www.googletagmanager.com/gtag/js?id=G-K0ZS0D9JLK';
      s.onload = function(){
        window.dataLayer = window.dataLayer || [];
        function gtag(){ dataLayer.push(arguments); }
        window.gtag = gtag;
        gtag('js', new Date());
        gtag('config', 'G-K0ZS0D9JLK');
      };
      document.head.appendChild(s);
    })();
  </script>

  <!-- (Varianta C) PRODUKČNÍ origin pro Netlify Functions (vyplň svojí doménou) -->
  <!-- Příklad: https://tvoje-domena.netlify.app -->
  <meta name="tm-proxy-base" content="">

  <script>
    // načti tm-proxy-base z <meta> a dej do globálu
    (function(){
      const meta = document.querySelector('meta[name="tm-proxy-base"]');
      const val = (meta && meta.content || '').trim();
      window.__TM_PROXY_BASE = val || '';
      if (!window.__TM_PROXY_BASE) {
        console.info('[TM] No explicit prod proxy base configured (meta tm-proxy-base is empty).');
      } else {
        console.info('[TM] Using explicit prod proxy base:', window.__TM_PROXY_BASE);
      }
    })();
  </script>

  <!-- Zapne inline Ticketmaster render (vypne core events pipeline v main.js) -->
  <script>window.__AJSEE_SKIP_CORE_EVENTS = true;</script>

  <!-- Modulový loader: v Netlify Dev (8888) načti HMR klient + main.js přímo z Vite (5173) -->
  <script type="module">
    (() => {
      const insertModule = (src) => {
        const s = document.createElement('script');
        s.type = 'module';
        s.src = src;
        document.head.appendChild(s);
      };
      const isNetlifyDev = location.hostname === 'localhost' && location.port === '8888';
      if (isNetlifyDev) {
        insertModule('http://localhost:5173/@vite/client');
        insertModule('http://localhost:5173/src/main.js');
      } else {
        insertModule('/src/main.js');
      }
    })();
  </script>
</head>
<body>
  <!-- Header a navigace -->
  <header class="site-header">
    <div class="header-inner">
      <a href="/" class="logo-link" aria-label="Domů">
        <img src="/images/logo-ajsee.png" alt="AJSEE Logo" class="logo" />
      </a>

      <button class="hamburger-btn" id="hamburger" aria-label="Otevřít menu" type="button">
        <span></span><span></span><span></span>
      </button>

      <nav class="main-nav" id="mainNav" role="navigation" aria-label="Hlavní menu">
        <button class="menu-close" aria-label="Zavřít menu" type="button">&times;</button>
        <ul>
          <li><a href="/" data-i18n-key="nav-home">Domů</a></li>
          <li><a href="/events.html" data-i18n-key="nav-events" aria-current="page">Události</a></li>
          <li><a href="/partners.html" data-i18n-key="nav-partners">Pro partnery</a></li>
          <li><a href="/about.html" data-i18n-key="nav-about">O nás</a></li>
          <li><a href="/blog.html" data-i18n-key="nav-blog">Blog</a></li>
          <li><a href="/faq.html" data-i18n-key="nav-faq">FAQ</a></li>
          <li><a href="#contact" data-i18n-key="nav-contact">Kontakt</a></li>
        </ul>

        <!-- Jazykové přepínače v mobilním menu -->
        <div class="language-switcher mobile-switcher">
          <button class="lang-btn" data-lang="cs" aria-label="Čeština"><img src="/images/flags/cz.svg" alt="Čeština" width="22" height="16"/></button>
          <button class="lang-btn" data-lang="en" aria-label="English"><img src="/images/flags/gb.svg" alt="English" width="22" height="16"/></button>
          <button class="lang-btn" data-lang="de" aria-label="Deutsch"><img src="/images/flags/de.svg" alt="Deutsch" width="22" height="16"/></button>
          <button class="lang-btn" data-lang="sk" aria-label="Slovenčina"><img src="/images/flags/sk.svg" alt="Slovenčina" width="22" height="16"/></button>
          <button class="lang-btn" data-lang="pl" aria-label="Polski"><img src="/images/flags/pl.svg" alt="Polski" width="22" height="16"/></button>
          <button class="lang-btn" data-lang="hu" aria-label="Magyar"><img src="/images/flags/hu.svg" alt="Magyar" width="22" height="16"/></button>
        </div>
      </nav>

      <!-- Jazykové přepínače – desktop -->
      <div class="language-switcher desktop-switcher" aria-label="Jazyk">
        <button class="lang-btn" data-lang="cs" aria-label="Čeština"><img src="/images/flags/cz.svg" alt="Čeština" width="22" height="16"/></button>
        <button class="lang-btn" data-lang="en" aria-label="English"><img src="/images/flags/gb.svg" alt="English" width="22" height="16"/></button>
        <button class="lang-btn" data-lang="de" aria-label="Deutsch"><img src="/images/flags/de.svg" alt="Deutsch" width="22" height="16"/></button>
        <button class="lang-btn" data-lang="sk" aria-label="Slovenčina"><img src="/images/flags/sk.svg" alt="Slovenčina" width="22" height="16"/></button>
        <button class="lang-btn" data-lang="pl" aria-label="Polski"><img src="/images/flags/pl.svg" alt="Polski" width="22" height="16"/></button>
        <button class="lang-btn" data-lang="hu" aria-label="Magyar"><img src="/images/flags/hu.svg" alt="Magyar" width="22" height="16"/></button>
      </div>

      <div class="menu-overlay-bg" aria-hidden="true"></div>
    </div>
  </header>

  <main id="main">
    <!-- Hero sekce -->
    <section class="events-hero" aria-labelledby="events-hero-title">
      <div class="container events-hero-content">
        <div class="events-hero-text">
          <h1 id="events-hero-title" class="events-hero-title" data-i18n-key="events-hero-title">
            Nejlepší zážitky na dosah
          </h1>
          <p class="events-hero-desc" data-i18n-key="events-hero-desc">
            Objevte koncerty, festivaly, divadlo i sportovní akce v jednom přehledném katalogu.
          </p>
          <a href="#upcoming-events" class="events-cta-btn" data-i18n-key="events-hero-cta">
            Zjistit nejbližší události
          </a>
        </div>
        <div class="events-hero-image" aria-hidden="true">
          <img src="/images/hero-events.svg" alt="" loading="lazy" />
        </div>
      </div>
    </section>

    <!-- Sekce: Nejbližší události -->
    <section id="upcoming-events" class="events-upcoming-section" aria-labelledby="events-upcoming-title" aria-busy="true" data-tm-size="6">
      <div class="container">

        <!-- FILTRY -->
        <form id="events-filters-form" class="events-filters filter-dock" novalidate data-behavior="sheet" role="search">
          <div class="filters-toolbar" aria-label="Rychlé filtry">
            <div class="chips">
              <button type="button" class="chip" id="chipToday" data-i18n-key="filters.today">Dnes</button>
              <button type="button" class="chip" id="chipWeekend" data-i18n-key="filters.weekend">Tento víkend</button>
              <button type="button" class="chip ghost" id="chipClear" data-i18n-key="filters.reset">Vymazat</button>
            </div>
            <button type="button" class="chip chip-near" id="chipNearMe" aria-label="Najít akce poblíž">
              <svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="3"></circle><path d="M12 2v3M12 19v3M2 12h3M19 12h3M4.9 4.9l2.1 2.1M17 17l2.1 2.1M4.9 19.1l2.1-2.1M17 7l2.1-2.1"/></svg>
              <span data-i18n-key="filters.nearMe">V mém okolí</span>
            </button>
          </div>

          <fieldset class="filters-fieldset">
            <legend class="sr-only">Filtry</legend>

            <div class="filter-group">
              <label for="filter-category" data-i18n-key="filters.category">Kategorie</label>
              <select id="filter-category" class="styled-select">
                <option value="all" data-i18n-key="filters.all">Vše</option>
                <option value="concert" data-i18n-key="category-concert">Koncerty</option>
                <option value="festival" data-i18n-key="category-festival">Festivaly</option>
                <option value="sport" data-i18n-key="category-sport">Sport</option>
                <option value="theatre" data-i18n-key="category-theatre">Divadlo</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="filter-sort" data-i18n-key="filters.sort">Řazení</label>
              <select id="filter-sort" class="styled-select">
                <option value="nearest" data-i18n-key="filters.nearest">Nejbližší</option>
                <option value="latest" data-i18n-key="filters.latest">Nejnovější</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="filter-city" data-i18n-key="filters.city">Město</label>
              <input id="filter-city" type="text" class="styled-input"
                     placeholder="Praha, Brno…" data-i18n-placeholder="filters.cityPlaceholder" autocomplete="off" />
            </div>

            <div class="filter-group">
              <label for="filter-date-from" data-i18n-key="filters.dateFrom">Od</label>
              <input id="filter-date-from" type="date" class="styled-input" />
            </div>

            <div class="filter-group">
              <label for="filter-date-to" data-i18n-key="filters.dateTo">Do</label>
              <input id="filter-date-to" type="date" class="styled-input" />
            </div>

            <div class="filter-group filter-keyword">
              <label for="filter-keyword" data-i18n-key="filters.keyword">Klíčové slovo</label>
              <input id="filter-keyword" type="search" class="styled-input"
                     placeholder="Umělec, místo, akce…" data-i18n-placeholder="filters.keywordPlaceholder" />
            </div>

            <div class="filter-actions">
              <button type="button" class="btn btn-ghost" id="filter-nearme" data-i18n-key="filters.nearMe">V mém okolí</button>
              <button type="submit" class="btn btn-primary" data-i18n-key="filters.apply">Použít filtry</button>
              <button type="reset" class="btn btn-ghost" data-i18n-key="filters.reset">Vymazat</button>
            </div>
          </fieldset>

          <button type="button" class="filters-close" id="filtersClose" aria-label="Zavřít filtry"></button>
        </form>

        <button type="button" class="filters-fab" id="filtersOpen" aria-controls="events-filters-form" data-i18n-key="filters.open">
          Filtry
        </button>
        <div class="filters-overlay" id="filtersOverlay" hidden aria-hidden="true"></div>

        <div class="event-demo-badge" id="demoBadge" role="note" aria-live="polite" aria-label="" data-i18n-aria="event-demo.ariaLabel">
          <span class="ib-icon" aria-hidden="true">✨</span>
          <p class="ib-text">
            <strong data-i18n-key="event-demo.title">Ukázkové události.</strong>
            <span data-i18n-key="event-demo.body">Připravujeme reálný prodej vstupenek. Sledujte nás!</span>
          </p>
          <a class="ib-cta" id="demoBadgeCta"
             href="/coming-soon?utm_source=site&utm_medium=demo_badge&utm_campaign=waitlist"
             data-i18n-key="event-demo.cta">Sleduj novinky</a>
        </div>

        <h2 class="events-upcoming-title" id="events-upcoming-title" data-i18n-key="events-upcoming-title">Nejbližší události</h2>

        <p id="tm-status" role="status" aria-live="polite" class="events-status"></p>
        <div id="tm-error" class="events-error" hidden></div>

        <div id="eventsList" class="events-list" aria-live="polite"></div>
        <noscript>Pro zobrazení událostí povolte JavaScript.</noscript>
      </div>
    </section>

    <section class="events-benefits why-us-section" aria-labelledby="events-benefits-title">
      <div class="container">
        <h3 id="events-benefits-title" data-i18n-key="events-benefits-title">Proč s námi?</h3>
        <div class="benefits-list" role="list">
          <div class="benefit" role="listitem">
            <span class="benefit-icon" aria-hidden="true">🎫</span>
            <span data-i18n-key="events-benefit-1">Originální vstupenky přímo od pořadatelů</span>
          </div>
          <div class="benefit" role="listitem">
            <span class="benefit-icon" aria-hidden="true">🤝</span>
            <span data-i18n-key="events-benefit-2">Lokální zákaznická podpora</span>
          </div>
          <div class="benefit" role="listitem">
            <span class="benefit-icon" aria-hidden="true">⭐</span>
            <span data-i18n-key="events-benefit-3">Pečlivě vybírané akce</span>
          </div>
        </div>
      </div>
    </section>

    <!-- MODAL: Detail události -->
    <div id="eventModal" class="event-modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="event-modal-content">
        <button id="modalClose" class="event-modal-close" aria-label="Zavřít" tabindex="0">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" stroke="currentColor" stroke-width="2.2" viewBox="0 0 24 24" aria-hidden="true">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
        <img id="modalImage" class="modal-image" alt="" />
        <div class="modal-details">
          <h2 id="modalTitle" class="modal-title"></h2>
          <p class="modal-meta">
            <span id="modalDate" class="modal-date"></span> |
            <span id="modalLocation" class="modal-location"></span>
          </p>
          <p id="modalDescription" class="modal-description"></p>
          <p class="modal-category">
            <span data-i18n-key="event-category">Kategorie:</span>
            <span id="modalCategory"></span>
          </p>
          <div class="calendar-buttons">
            <span class="calendar-label" data-i18n-key="add-to-calendar">Přidat do kalendáře:</span>
            <div class="calendar-btns-wrap">
              <a href="#" id="googleCalendarLink" class="calendar-btn calendar-btn--google" target="_blank" rel="noopener">
                <span class="calendar-btn-icon" aria-hidden="true"></span>
                <span class="calendar-btn-label" data-i18n-key="calendar-google">Google</span>
              </a>
              <a href="#" id="outlookCalendarLink" class="calendar-btn calendar-btn--outlook" target="_blank" rel="noopener">
                <span class="calendar-btn-icon" aria-hidden="true"></span>
                <span class="calendar-btn-label" data-i18n-key="calendar-outlook">Outlook</span>
              </a>
              <a href="#" id="appleCalendarLink" class="calendar-btn calendar-btn--apple" download="event.ics">
                <span class="calendar-btn-icon" aria-hidden="true"></span>
                <span class="calendar-btn-label" data-i18n-key="calendar-apple">Apple / ICS</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <!-- Footer -->
  <footer>
    <div class="footer-social" aria-label="Sociální sítě">
      <a href="https://www.instagram.com/ajseeofficial/" target="_blank" rel="noopener" aria-label="Instagram">
        <img src="/images/icons/instagram.svg" alt="" />
      </a>
      <a href="https://www.facebook.com/profile.php?id=61565404319940" target="_blank" rel="noopener" aria-label="Facebook">
        <img src="/images/icons/facebook.svg" alt="" />
      </a>
      <a href="https://x.com/ajseeofficial" target="_blank" rel="noopener" aria-label="X / Twitter">
        <img src="/images/icons/twitter.svg" alt="" />
      </a>
      <a href="https://www.linkedin.com/company/ajsee" target="_blank" rel="noopener" aria-label="LinkedIn">
        <img src="/images/icons/linkedin.svg" alt="" />
      </a>
    </div>
    <p data-i18n-key="footer-copyright">&copy; 2025 AJSEE®. Všechna práva vyhrazena.</p>
  </footer>

  <!-- Ticketmaster – inline s proxy fallbacky (Varianta C) -->
  <script type="module">
    // --- helpers
    const t = (dict, lang) => dict[lang] || dict.en || '';
    const pickImage = (images = []) => {
      if (!images.length) return null;
      const best = images
        .filter(i => i && i.ratio === '16_9' && (i.width || 0) >= 640)
        .sort((a,b) => (b.width||0) - (a.width||0))[0];
      return best || images[0];
    };
    const fmt = (start = {}, locale = 'en-GB') => {
      const d = start.dateTime ||
        (start.localDate && (start.localTime
          ? (start.localDate + 'T' + start.localTime)
          : (start.localDate + 'T00:00:00')));
      if (!d) return '';
      const dt = new Date(d);
      const day  = new Intl.DateTimeFormat(locale, { weekday: 'short' }).format(dt);
      const date = new Intl.DateTimeFormat(locale, { day: '2-digit', month: 'short', year: 'numeric' }).format(dt);
      const time = start.noSpecificTime ? '' : new Intl.DateTimeFormat(locale, { hour: '2-digit', minute: '2-digit' }).format(dt);
      return [day, date, time].filter(Boolean).join(' • ');
    };
    function renderCard(event, { lang, locale }) {
      const el = document.createElement('article'); el.className = 'event-card';
      const h = document.createElement('h3'); h.className = 'event-title'; h.textContent = event?.name || ''; el.appendChild(h);
      const when = fmt(event?.dates?.start || {}, locale); if (when) { const p = document.createElement('p'); p.className = 'event-datetime'; p.textContent = when; el.appendChild(p); }
      const v = event?._embedded?.venues?.[0]; if (v) { const p = document.createElement('p'); p.className = 'event-venue'; p.textContent = [v?.city?.name, v?.name].filter(Boolean).join(' • '); el.appendChild(p); }
      const img = pickImage(event?.images); if (img) { const i = document.createElement('img'); i.className = 'event-image'; i.src = img.url; i.alt = event?.name || 'Event'; i.loading = 'lazy'; el.appendChild(i); }
      const a = document.createElement('a'); a.className = 'buy-link'; a.target = '_blank'; a.rel = 'noopener noreferrer';
      a.textContent = t({ cs: 'Koupit vstupenky', sk: 'Kúpiť vstupenky', de: 'Tickets kaufen', pl: 'Kup bilety', hu: 'Jegyvásárlás', en: 'Buy tickets' }, lang);
      a.href = event?.url || '#'; el.appendChild(a);
      return el;
    }

    // Timeout wrapper
    async function fetchWithTimeout(url, { timeout = 7000, ...opts } = {}) {
      const ctrl = new AbortController();
      const tid = setTimeout(() => ctrl.abort(), timeout);
      try {
        const r = await fetch(url.toString(), { ...opts, signal: ctrl.signal });
        if (!r.ok) throw new Error('HTTP ' + r.status);
        return r;
      } finally { clearTimeout(tid); }
    }
    async function fetchJSON(url, opts) {
      const r = await fetchWithTimeout(url, opts);
      return r.json();
    }

    // --- init
    (async () => {
      const listEl   = document.querySelector('#eventsList');
      const statusEl = document.querySelector('#tm-status');
      const errorEl  = document.querySelector('#tm-error');
      const section  = document.querySelector('#upcoming-events');

      const setBusy   = b => section?.setAttribute('aria-busy', String(b));
      const setStatus = m => { if (statusEl) statusEl.textContent = m || ''; };

      const qs   = new URLSearchParams(location.search);
      const lang = (qs.get('lang') || document.documentElement.lang || 'en').toLowerCase();
      const localeMap = { cs:'cs-CZ', sk:'sk-SK', en:'en-GB', de:'de-DE', pl:'pl-PL', hu:'hu-HU' };
      const locale = localeMap[lang] || 'en-GB';
      const defaultCountryByLang = { cs:'CZ', sk:'SK', en:'GB', de:'DE', pl:'PL', hu:'HU' };
      const country = (qs.get('country') || defaultCountryByLang[lang] || 'GB').toUpperCase();
      const size = Number(section?.dataset?.tmSize || 6);

      setBusy(true);
      setStatus(t({
        cs:'Načítám události…', sk:'Načítavam podujatia…', de:'Lade Events…',
        pl:'Wczytywanie wydarzeń…', hu:'Események betöltése…', en:'Loading events…'
      }, lang));

      // Čas bez milisekund (TM je na to citlivý)
      const start = new Date().toISOString().split('.')[0] + 'Z';

      // Přímý TM endpoint
      const API_KEY = 'b4BHSTzR1GEhE1bcGbQC5k696Dj1oA0D'; // AJSEE-test (Public APIs)
      const direct = new URL('https://app.ticketmaster.com/discovery/v2/events.json');
      direct.searchParams.set('apikey', API_KEY);
      direct.searchParams.set('size', String(size));
      direct.searchParams.set('sort', 'date,asc');
      direct.searchParams.set('startDateTime', start);
      direct.searchParams.set('countryCode', country);

      // Proxy fallbacky
      const isLocal = ['localhost','127.0.0.1'].includes(location.hostname);

      // (C) explicitní produkční proxy, pokud je nastavená
      const explicit = (window.__TM_PROXY_BASE && /^https?:\/\//i.test(window.__TM_PROXY_BASE))
        ? new URL('/.netlify/functions/tm', window.__TM_PROXY_BASE)
        : null;

      const proxyBases = [
        ...(explicit ? [explicit] : []),
        new URL('/.netlify/functions/tm', location.origin),
        ...(isLocal ? [
          new URL('http://localhost:8888/.netlify/functions/tm'),
          new URL('http://127.0.0.1:8888/.netlify/functions/tm'),
        ] : []),
      ];

      const buildProxyUrl = (base) => {
        const u = new URL(base);
        u.searchParams.set('path', '/discovery/v2/events.json');
        u.searchParams.set('size', String(size));
        u.searchParams.set('sort', 'date,asc');
        u.searchParams.set('startDateTime', start);
        u.searchParams.set('countryCode', country);
        return u;
      };

      async function tryProxies() {
        let lastErr;
        for (const base of proxyBases) {
          const url = buildProxyUrl(base);
          try {
            console.info('[TM] Trying proxy:', url.toString());
            return await fetchJSON(url, { mode: 'cors' });
          } catch (e) { lastErr = e; }
        }
        throw lastErr || new Error('No proxy available');
      }

      // Proxy-first v dev / ne-HTTPS, jinak direct s timeoutem
      const PROXY_FIRST = isLocal || location.protocol !== 'https:';

      try {
        let data;
        if (PROXY_FIRST) {
          console.info('[TM] Proxy-first mode');
          try {
            data = await tryProxies();
          } catch (proxyErr) {
            console.info('[TM] Proxies failed – trying direct as last resort…');
            data = await fetchJSON(direct, { mode: 'cors', timeout: 7000 });
          }
        } else {
          try {
            console.info('[TM] Trying direct TM request…');
            data = await fetchJSON(direct, { mode: 'cors', timeout: 5000 });
          } catch (e) {
            console.info('[TM] Direct failed (', e?.message || 'unknown', ') – trying proxies…');
            data = await tryProxies();
          }
        }

        const events = data?._embedded?.events || [];
        if (!events.length) {
          setStatus(t({
            cs:'V tomto výběru nejsou žádné nadcházející události.',
            sk:'V tomto výbere nie sú žiadne nadchádzajúce podujatia.',
            de:'Keine anstehenden Events in dieser Auswahl.',
            pl:'Brak nadchodzących wydarzeń w tym wyborze.',
            hu:'Nincs közelgő esemény ebben a nézetben.',
            en:'No upcoming events for this selection.'
          }, lang));
          setBusy(false);
          return;
        }

        listEl.innerHTML = '';
        events.forEach(ev => listEl.appendChild(renderCard(ev, { lang, locale })));
        setStatus('');
      } catch (e) {
        console.error('[TM] fetch error', e);
        if (errorEl) {
          errorEl.hidden = false;
          const msg = t({
            cs:'Nepodařilo se načíst data z Ticketmasteru. Zkuste to prosím později.',
            sk:'Nepodarilo sa načítať dáta z Ticketmasteru. Skúste to neskôr.',
            de:'Ticketmaster-Daten konnten nicht geladen werden. Bitte später erneut versuchen.',
            pl:'Nie udało się załadować danych z Ticketmastera. Spróbuj ponownie później.',
            hu:'Nem sikerült betölteni a Ticketmaster adatait. Próbáld újra később.',
            en:'Could not load Ticketmaster data. Please try again later.'
          }, lang);

          const hintLocal = (isLocal)
            ? '\n\nTip: Spusť `netlify dev` (port 8888) NEBO vyplň <meta name="tm-proxy-base" content="https://tvoje-domena.netlify.app">.'
            : '';

          errorEl.textContent = msg + hintLocal;
        }
      } finally {
        setBusy(false);
      }
    })();
  </script>

  <!-- Demo badge CTA -->
  <script>
    (function(){
      const cta = document.getElementById('demoBadgeCta');
      const root = document.getElementById('demoBadge');
      if (!cta) return;

      const qs = new URLSearchParams(location.search);
      const lang = (qs.get('lang') || '').toLowerCase();
      if (['cs','en','de','sk','pl','hu'].includes(lang)) {
        const url = new URL(cta.href, location.origin);
        url.searchParams.set('lang', lang);
        cta.href = url.toString();
      }

      cta.addEventListener('click', function(){
        if (window.gtag) window.gtag('event','click_waitlist', { source: 'events_demo_badge' });
      });

      if (root && window.translations) {
        try {
          const path = 'event-demo.ariaLabel'.split('.');
          let val = window.translations;
          for (const k of path) { val = val && typeof val === 'object' ? val[k] : undefined; }
          if (typeof val === 'string' && val.trim()) root.setAttribute('aria-label', val);
        } catch(e) {}
      }
    })();
  </script>
</body>
</html>
